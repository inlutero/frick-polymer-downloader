<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/webcomponentsjs/webcomponents-lite.js">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html" <link rel="import" href="../bower_components/neon-animation/web-animations.js">
<link rel="import" href="../src/my-icons.html">

<dom-module id="my-list-checker">
  <template>

    <custom-style>
      <style is="custom-style" include="shared-styles">
        paper-tabs {
          width: 400px;
        }

        .vertical-section-container {
          max-width: 300px;
        }

        paper-dropdown-menu {
          width: 200px;
          margin-right: 20px;
        }
        vaadin-grid {
          -webkit-user-select: text;
          -moz-user-select: text;
          -ms-user-select: text;
          user-select: text;
        }
      </style>
    </custom-style>
    <div class="card halfCard">
      <paper-dropdown-menu label="Search Field" vertical-align="bottom" horizontal-align="left">
        <paper-listbox class="dropdown-content" slot="dropdown-content" attr-for-selected="value" selected="{{selection}}">
          <paper-item value="Barcode">Barcode</paper-item>
          <paper-item value="bibRecordNumber">Bib Record Number</paper-item>
          <paper-item value="fileName">File Name</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
      <h1>List Checker</h1>
      <div>

      </div>
      <div>
        <iron-autogrow-textarea id="textList" on-value-changed="checkList" value="{{listValues}}" id="text1" rows="15" style="width:100%;margin-bottom:15px;" placeholder="Cut and paste or drag and drop barcode list text here."></iron-autogrow-textarea>
      </div>
    </div>
    <div class="card halfCard">
      <h1>Results</h1>
      <template is="dom-if" if="{{itemsMissedFound}}">
        <h3>Not Found</h3>
        <vaadin-grid items="[[itemsMissed]]" rows="20">
          <table>
            <colgroup>
              <col name="_source.Barcode" sortable/>
            </colgroup>
            <thead>
              <tr>
                <th>Search Term</th>
              </tr>
            </thead>
          </table>
        </vaadin-grid>
      </template>
      <vaadin-grid items="[[documents]]" rows="20" selection-mode="">
        <table>
          <colgroup>
            <col name="_source.Barcode" sortable/>
            <col name="_source.FileName" sortable/>
            <col name="_source.total" />
            <col name="_source.Path" />
          </colgroup>
          <thead>
            <tr>
              <th>Barcode</th>
              <th>File Name</th>
              <th>Group Count</th>
              <th>Path</th>
            </tr>
          </thead>
        </table>
      </vaadin-grid>
    </div>
  </template>

  <script>
    Polymer({
      is: 'my-list-checker',
      properties: {
        'arrayOfLines': {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: []
        },
        'selection': {
          type: String,
          notify: true
        },
        'itemsMissed': {
          type: Array,
          notify: true,
          reflectToAttribute: true,
          value: [],
          observer: '_itemsMissed'
        },
        'itemsMissedFound': {
          type: Boolean,
          notify: true,
          value: false
        }
      },
      showSelection: function(i) {
        console.log(this.selection)
      },
      _itemsMissed: function() {
        console.log('items missed function triggered')
        if (this.itemsMissed != '') {
          this.set('itemsMissedFound', true)
        } else if (this.itemsMissed == '') {
          this.set('itemMissedFound', false)
        }
        console.log(this.itemsMissedFound)
      },
      checkList: function(e) {
        if (!e.detail) {
          return
        }
        console.log(arguments)
        console.log(this.selection)
        this.debounce('checkList', function() {
          if (this.listValues != '') {
            var separators = [' ', '\n', ','];
            var arrayOfLines = this.listValues.split(new RegExp(separators.join('|'), '')).filter(bcode => bcode.trim().length > 0)
            this.set('arrayOfLines', arrayOfLines)
            console.log(`new array ${JSON.stringify(this.arrayOfLines)}`)
          } else if (this.listValues == '') {
            var arrayOfLines = []
            this.set('arrayOfLines', arrayOfLines)
            this.itemsMissed = [];
            this.itemsMissedFound = false;
            console.log(`emptying this array of lines`)
            console.log(`new arrayOfLines is ${this.arrayOfLines}`)
          }
        }, 300);
      }
    });
  </script>
</dom-module>
