<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<linl rel="import" href="../bower_components/webcomponentsjs/webcomponents-lite.min.js">
  <link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html">
  <link rel="import" href="../bower_components/polymer/polymer.html">
  <link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
  <link rel="import" href="shared-styles.html">

  <dom-module id="my-doc-updater">
    <template>
      <template is="dom-repeat" items="[[arrayOfLines]]">
        <iron-ajax auto url="http://192.168.10.85/api/search/details/Barcode/{{item}}" handle-as="json" on-response="handleResponse" data-item$="[[item]]"></iron-ajax>
      </template>
    </template>
    <script>
      Polymer({
            is: 'my-doc-updater',
            properties: {
              'arrayOfLines': {
                type: Array,
                observer: '_updateArray'
              },
              'documents': {
                type: Array,
                notify: true,
                value: []
              }
            },
            handleResponse: function(event) {
              console.log(`fetch data for ${event.target.getAttribute('data-item')}`)
              var response = event.detail.response
              console.log(`response ${response.documents.hits.hits.map(function(hit){ return hit._source.FileName})}`)
              var params = ['documents'].concat(response.documents.hits.hits)
              this.push.apply(this, params)
              console.log(`documents ${this.documents.map(function(hit){ return hit._source.FileName})}`)
            },
            _updateArray: function() {
          /*  console.log("resetting documents")
              this.set('documents', [])*/
            }
          });
    </script>
  </dom-module>
